  const ITEMS = [{"type": "domain", "id": "A.5", "label": "ORGANIZATIONAL CONTROLS"}, {"type": "control", "id": "A.5.1", "title": "Policies for information security", "description": "Information security policy and topic-specific policies should be defined, approved by management, published, communicated to and acknowledged by relevant personnel and relevant interested parties, and reviewed at planned intervals and if significant changes occur.", "raw": "Policies for information security\nInformation security policy and topic-specific policies should be defined, approved by management, published, communicated to and acknowledged by relevant personnel and relevant interested parties, and reviewed at planned intervals and if significant changes occur."}, {"type": "control", "id": "A.5.2", "title": "Information security roles and responsibilities", "description": "Information security roles and responsibilities should be defined and allocated according to the organization needs.", "raw": "Information security roles and responsibilities\nInformation security roles and responsibilities should be defined and allocated according to the organization needs."}, {"type": "control", "id": "A.5.3", "title": "Segregation of duties", "description": "Conflicting duties and conflicting areas of responsibility should be segregated.", "raw": "Segregation of duties\nConflicting duties and conflicting areas of responsibility should be segregated."}, {"type": "control", "id": "A.5.4", "title": "Management responsibilities", "description": "Management should require all personnel to apply information security in accordance with the established information security policy, topic-specific policies and procedures of the organization.", "raw": "Management responsibilities\nManagement should require all personnel to apply information security in accordance with the established information security policy, topic-specific policies and procedures of the organization."}, {"type": "control", "id": "A.5.5", "title": "Contact with authorities", "description": "The organization should establish and maintain contact with relevant authorities.", "raw": "Contact with authorities\nThe organization should establish and maintain contact with relevant authorities."}, {"type": "control", "id": "A.5.6", "title": "Contact with special interest groups", "description": "The organization should establish and maintain contact with special interest groups or other specialist security forums and professional associations.", "raw": "Contact with special interest groups\nThe organization should establish and maintain contact with special interest groups or other specialist security forums and professional associations."}, {"type": "control", "id": "A.5.7", "title": "Threat intelligence", "description": "Information relating to information security threats should be collected and analysed to produce threat intelligence.", "raw": "Threat intelligence\nInformation relating to information security threats should be collected and analysed to produce threat intelligence."}, {"type": "control", "id": "A.5.8", "title": "Information security in project management", "description": "Information security should be integrated into project management.", "raw": "Information security in project management\nInformation security should be integrated into project management."}, {"type": "control", "id": "A.5.9", "title": "Inventory of information and other associated assets", "description": "An inventory of information and other associated assets, including owners, should be developed and maintained.", "raw": "Inventory of information and other associated assets\nAn inventory of information and other associated assets, including owners, should be developed and maintained."}, {"type": "control", "id": "A.5.10", "title": "Acceptable use of information and other associated assets", "description": "Rules for the acceptable use and procedures for handling information and other associated assets should be identified, documented and implemented.", "raw": "Acceptable use of information and other associated assets\nRules for the acceptable use and procedures for handling information and other associated assets should be identified, documented and implemented."}, {"type": "control", "id": "A.5.11", "title": "Return of assets", "description": "Personnel and other interested parties as appropriate should return all the organization’s assets in their possession upon change or termination of their employment, contract or agreement.", "raw": "Return of assets\nPersonnel and other interested parties as appropriate should return all the organization’s assets in their possession upon change or termination of their employment, contract or agreement."}, {"type": "control", "id": "A.5.12", "title": "Classification of information", "description": "Information should be classified according to the information security needs of the organization based on confidentiality, integrity, availability and relevant interested party requirements.", "raw": "Classification of information\nInformation should be classified according to the information security needs of the organization based on confidentiality, integrity, availability and relevant interested party requirements."}, {"type": "control", "id": "A.5.13", "title": "Labeling of information", "description": "An appropriate set of procedures for information labeling should be developed and implemented in accordance with the information classification scheme adopted by the organization.", "raw": "Labeling of information\nAn appropriate set of procedures for information labeling should be developed and implemented in accordance with the information classification scheme adopted by the organization."}, {"type": "control", "id": "A.5.14", "title": "Information transfer", "description": "Information transfer rules, procedures, or agreements should be in place for all types of transfer facilities within the organization and between the organization and other parties.", "raw": "Information transfer\nInformation transfer rules, procedures, or agreements should be in place for all types of transfer facilities within the organization and between the organization and other parties."}, {"type": "control", "id": "A.5.15", "title": "Access control", "description": "Rules to control physical and logical access to information and other associated assets should be established and implemented based on business and information security requirements.", "raw": "Access control\nRules to control physical and logical access to information and other associated assets should be established and implemented based on business and information security requirements."}, {"type": "control", "id": "A.5.16", "title": "Identity management", "description": "The full life cycle of identities should be managed.", "raw": "Identity management\nThe full life cycle of identities should be managed."}, {"type": "control", "id": "A.5.17", "title": "Authentication information", "description": "Allocation and management of authentication information should be controlled by a management process, including advising personnel on the appropriate handling of authentication information.", "raw": "Authentication information\nAllocation and management of authentication information should be controlled by a management process, including advising personnel on the appropriate handling of authentication information."}, {"type": "control", "id": "A.5.18", "title": "Access rights", "description": "Access rights to information and other associated assets should be provisioned, reviewed, modified and removed in accordance with the organization’s topic-specific policy on and rules for access control.", "raw": "Access rights\nAccess rights to information and other associated assets should be provisioned, reviewed, modified and removed in accordance with the organization’s topic-specific policy on and rules for access control."}, {"type": "control", "id": "A.5.19", "title": "Information security in supplier relationships", "description": "Processes and procedures should be defined and implemented to manage the information security risks associated with the use of supplier’s products or services.", "raw": "Information security in supplier relationships\nProcesses and procedures should be defined and implemented to manage the information security risks associated with the use of supplier’s products or services."}, {"type": "control", "id": "A.5.20", "title": "Addressing information security within supplier agreements", "description": "Relevant information security requirements should be established and agreed with each supplier based on the type of supplier relationship.", "raw": "Addressing information security within supplier agreements\nRelevant information security requirements should be established and agreed with each supplier based on the type of supplier relationship."}, {"type": "control", "id": "A.5.21", "title": "Managing information security in the ICT supply chain", "description": "Processes and procedures should be defined and implemented to manage the information security risks associated with the ICT products and services supply chain.", "raw": "Managing information security in the ICT supply chain\nProcesses and procedures should be defined and implemented to manage the information security risks associated with the ICT products and services supply chain."}, {"type": "control", "id": "A.5.22", "title": "Monitoring, review and change management of supplier services", "description": "The organization should regularly monitor, review, evaluate and manage change in supplier information security practices and service delivery.", "raw": "Monitoring, review and change management of supplier services\nThe organization should regularly monitor, review, evaluate and manage change in supplier information security practices and service delivery."}, {"type": "control", "id": "A.5.23", "title": "Information security for use of cloud services", "description": "Processes for acquisition, use, management and exit from cloud services should be established in accordance with the organization’s information security requirements.", "raw": "Information security for use of cloud services\nProcesses for acquisition, use, management and exit from cloud services should be established in accordance with the organization’s information security requirements."}, {"type": "control", "id": "A.5.24", "title": "Information security incident management planning and preparation", "description": "The organization should plan and prepare for managing information security incidents by defining, establishing and communicating information security incident management processes, roles and responsibilities.", "raw": "Information security incident management planning and preparation\nThe organization should plan and prepare for managing information security incidents by defining, establishing and communicating information security incident management processes, roles and responsibilities."}, {"type": "control", "id": "A.5.25", "title": "Assessment and decision on information security events", "description": "The organization should assess information security events and decide if they are to be categorized as information security incidents.", "raw": "Assessment and decision on information security events\nThe organization should assess information security events and decide if they are to be categorized as information security incidents."}, {"type": "control", "id": "A.5.26", "title": "Response to information security incidents", "description": "Information security incidents should be responded to in accordance with the documented procedures.", "raw": "Response to information security incidents\nInformation security incidents should be responded to in accordance with the documented procedures."}, {"type": "control", "id": "A.5.27", "title": "Learning from information security incidents", "description": "Knowledge gained from information security incidents should be used to strengthen and improve the information security controls.", "raw": "Learning from information security incidents\nKnowledge gained from information security incidents should be used to strengthen and improve the information security controls."}, {"type": "control", "id": "A.5.28", "title": "Collection of evidence", "description": "The organization should establish and implement procedures for the identification, collection, acquisition and preservation of evidence related to information security events.", "raw": "Collection of evidence\nThe organization should establish and implement procedures for the identification, collection, acquisition and preservation of evidence related to information security events."}, {"type": "control", "id": "A.5.29", "title": "Information security during disruption", "description": "The organization should plan how to maintain information security at an appropriate level during disruption.", "raw": "Information security during disruption\nThe organization should plan how to maintain information security at an appropriate level during disruption."}, {"type": "control", "id": "A.5.30", "title": "ICT readiness for business continuity", "description": "ICT readiness should be planned, implemented, maintained and tested based on business continuity objectives and ICT continuity requirements.", "raw": "ICT readiness for business continuity\nICT readiness should be planned, implemented, maintained and tested based on business continuity objectives and ICT continuity requirements."}, {"type": "control", "id": "A.5.31", "title": "Legal, statutory, regulatory and contractual requirements", "description": "Legal, statutory, regulatory and contractual requirements relevant to information security and the organization’s approach to meet these requirements should be identified, documented and kept up to date.", "raw": "Legal, statutory, regulatory and contractual requirements\nLegal, statutory, regulatory and contractual requirements relevant to information security and the organization’s approach to meet these requirements should be identified, documented and kept up to date."}, {"type": "control", "id": "A.5.32", "title": "Intellectual property rights", "description": "The organization should implement appropriate procedures to protect intellectual property rights.", "raw": "Intellectual property rights\nThe organization should implement appropriate procedures to protect intellectual property rights."}, {"type": "control", "id": "A.5.33", "title": "Protection of records", "description": "Records should be protected from loss, destruction, falsification, unauthorized access and unauthorized release.", "raw": "Protection of records\nRecords should be protected from loss, destruction, falsification, unauthorized access and unauthorized release."}, {"type": "control", "id": "A.5.34", "title": "Privacy and protection of PII", "description": "The organization should identify and meet the requirements regarding the preservation of privacy and protection of PII according to applicable laws and regulations and contractual requirements.", "raw": "Privacy and protection of PII\nThe organization should identify and meet the requirements regarding the preservation of privacy and protection of PII according to applicable laws and regulations and contractual requirements."}, {"type": "control", "id": "A.5.35", "title": "Independent review of information security", "description": "The organization’s approach to managing information security and its implementation including people, processes and technologies should be reviewed independently at planned intervals, or when significant changes occur.", "raw": "Independent review of information security\nThe organization’s approach to managing information security and its implementation including people, processes and technologies should be reviewed independently at planned intervals, or when significant changes occur."}, {"type": "control", "id": "A.5.36", "title": "Compliance with policies, rules and standards for information security", "description": "Compliance with the organization’s information security policy, topic-specific policies, rules and standards should be regularly reviewed.", "raw": "Compliance with policies, rules and standards for information security\nCompliance with the organization’s information security policy, topic-specific policies, rules and standards should be regularly reviewed."}, {"type": "control", "id": "A.5.37", "title": "Documented operating procedures", "description": "Operating procedures for information processing facilities should be documented and made available to personnel who need them.", "raw": "Documented operating procedures\nOperating procedures for information processing facilities should be documented and made available to personnel who need them."}, {"type": "domain", "id": "A.6", "label": "PEOPLE CONTROLS"}, {"type": "control", "id": "A.6.1", "title": "Screening", "description": "Background verification checks on all candidates to become personnel should be carried out prior to joining the organization and on an ongoing basis taking into consideration applicable laws, regulations and ethics and be proportional to the business requirements, the classification of the information to be accessed and the perceived risks.", "raw": "Screening\nBackground verification checks on all candidates to become personnel should be carried out prior to joining the organization and on an ongoing basis taking into consideration applicable laws, regulations and ethics and be proportional to the business requirements, the classification of the information to be accessed and the perceived risks."}, {"type": "control", "id": "A.6.2", "title": "Terms and conditions of employment", "description": "The employment contractual agreements should state the personnel’s and the organization’s responsibilities for information security.", "raw": "Terms and conditions of employment\nThe employment contractual agreements should state the personnel’s and the organization’s responsibilities for information security."}, {"type": "control", "id": "A.6.3", "title": "Information security awareness, education and training", "description": "Personnel of the organization and relevant interested parties should receive appropriate information security awareness, education and training and regular updates of the organization's information security policy, topic-specific policies and procedures, as relevant for their job function.", "raw": "Information security awareness, education and training\nPersonnel of the organization and relevant interested parties should receive appropriate information security awareness, education and training and regular updates of the organization's information security policy, topic-specific policies and procedures, as relevant for their job function."}, {"type": "control", "id": "A.6.4", "title": "Disciplinary process", "description": "A disciplinary process should be formalized and communicated to take actions against personnel and other relevant interested parties who have committed an information security policy violation.", "raw": "Disciplinary process\nA disciplinary process should be formalized and communicated to take actions against personnel and other relevant interested parties who have committed an information security policy violation."}, {"type": "control", "id": "A.6.5", "title": "Responsibilities after termination or change of employment", "description": "Information security responsibilities and duties that remain valid after termination or change of employment should be defined, enforced and communicated to relevant personnel and other interested parties.", "raw": "Responsibilities after termination or change of employment\nInformation security responsibilities and duties that remain valid after termination or change of employment should be defined, enforced and communicated to relevant personnel and other interested parties."}, {"type": "control", "id": "A.6.6", "title": "Confidentiality or non-disclosure agreements", "description": "Confidentiality or non-disclosure agreements reflecting the organization’s needs for the protection of information should be identified, documented, regularly reviewed and signed by personnel and other relevant interested parties.", "raw": "Confidentiality or non-disclosure agreements\nConfidentiality or non-disclosure agreements reflecting the organization’s needs for the protection of information should be identified, documented, regularly reviewed and signed by personnel and other relevant interested parties."}, {"type": "control", "id": "A.6.7", "title": "Remote working", "description": "Security measures should be implemented when personnel are working remotely to protect information accessed, processed or stored outside the organization’s premises.", "raw": "Remote working\nSecurity measures should be implemented when personnel are working remotely to protect information accessed, processed or stored outside the organization’s premises."}, {"type": "control", "id": "A.6.8", "title": "Information security event reporting", "description": "The organization should provide a mechanism for personnel to report observed or suspected information security events through appropriate channels in a timely manner.", "raw": "Information security event reporting\nThe organization should provide a mechanism for personnel to report observed or suspected information security events through appropriate channels in a timely manner."}, {"type": "domain", "id": "A.7", "label": "PHYSICAL CONTROLS"}, {"type": "control", "id": "A.7.1", "title": "Physical security perimeters", "description": "Security perimeters should be defined and used to protect areas that contain information and other associated assets.", "raw": "Physical security perimeters\nSecurity perimeters should be defined and used to protect areas that contain information and other associated assets."}, {"type": "control", "id": "A.7.2", "title": "Physical entry", "description": "Secure areas should be protected by appropriate entry controls and access points.", "raw": "Physical entry\nSecure areas should be protected by appropriate entry controls and access points."}, {"type": "control", "id": "A.7.3", "title": "Securing offices, rooms and facilities", "description": "Physical security for offices, rooms and facilities should be designed and implemented.", "raw": "Securing offices, rooms and facilities\nPhysical security for offices, rooms and facilities should be designed and implemented."}, {"type": "control", "id": "A.7.4", "title": "Physical security monitoring", "description": "Premises should be continuously monitored for unauthorized physical access.", "raw": "Physical security monitoring\nPremises should be continuously monitored for unauthorized physical access."}, {"type": "control", "id": "A.7.5", "title": "Protecting against physical and environmental threats", "description": "Protection against physical and environmental threats, such as natural disasters and other intentional or unintentional physical threats to infrastructure should be designed and implemented.", "raw": "Protecting against physical and environmental threats\nProtection against physical and environmental threats, such as natural disasters and other intentional or unintentional physical threats to infrastructure should be designed and implemented."}, {"type": "control", "id": "A.7.6", "title": "Working in secure areas", "description": "Security measures for working in secure areas should be designed and implemented.", "raw": "Working in secure areas\nSecurity measures for working in secure areas should be designed and implemented."}, {"type": "control", "id": "A.7.7", "title": "Clear desk and clear screen", "description": "Clear desk rules for papers and removable storage media and clear screen rules for information processing facilities should be defined and appropriately enforced.", "raw": "Clear desk and clear screen\nClear desk rules for papers and removable storage media and clear screen rules for information processing facilities should be defined and appropriately enforced."}, {"type": "control", "id": "A.7.8", "title": "Equipment siting and protection", "description": "Equipment should be sited securely and protected.", "raw": "Equipment siting and protection\nEquipment should be sited securely and protected."}, {"type": "control", "id": "A.7.9", "title": "Security of assets off-premises", "description": "Off-site assets should be protected.", "raw": "Security of assets off-premises\nOff-site assets should be protected."}, {"type": "control", "id": "A.7.10", "title": "Storage media", "description": "Storage media should be managed through their life cycle of acquisition, use, transportation and disposal in accordance with the organization’s classification scheme and handling requirements.", "raw": "Storage media\nStorage media should be managed through their life cycle of acquisition, use, transportation and disposal in accordance with the organization’s classification scheme and handling requirements."}, {"type": "control", "id": "A.7.11", "title": "Supporting utilities", "description": "Information processing facilities should be protected from power failures and other disruptions caused by failures in supporting utilities.", "raw": "Supporting utilities\nInformation processing facilities should be protected from power failures and other disruptions caused by failures in supporting utilities."}, {"type": "control", "id": "A.7.12", "title": "Cabling security", "description": "Cables carrying power, data or supporting information services should be protected from interception, interference or damage.", "raw": "Cabling security\nCables carrying power, data or supporting information services should be protected from interception, interference or damage."}, {"type": "control", "id": "A.7.13", "title": "Equipment maintenance", "description": "Equipment should be maintained correctly to ensure availability, integrity and confidentiality of information.", "raw": "Equipment maintenance\nEquipment should be maintained correctly to ensure availability, integrity and confidentiality of information."}, {"type": "control", "id": "A.7.14", "title": "Secure disposal or re-use of equipment", "description": "Items of equipment containing storage media should be verified to ensure that any sensitive data and licensed software has been removed or securely overwritten prior to disposal or re-use.", "raw": "Secure disposal or re-use of equipment\nItems of equipment containing storage media should be verified to ensure that any sensitive data and licensed software has been removed or securely overwritten prior to disposal or re-use."}, {"type": "domain", "id": "A.8", "label": "TECHNICAL CONTROLS"}, {"type": "control", "id": "A.8.1", "title": "User endpoint devices", "description": "Information stored on, processed by or accessible via user endpoint devices should be protected.", "raw": "User endpoint devices\nInformation stored on, processed by or accessible via user endpoint devices should be protected."}, {"type": "control", "id": "A.8.2", "title": "Privileged access rights", "description": "The allocation and use of privileged access rights should be restricted and managed.", "raw": "Privileged access rights\nThe allocation and use of privileged access rights should be restricted and managed."}, {"type": "control", "id": "A.8.3", "title": "Information access restriction", "description": "Access to information and other associated assets should be restricted in accordance with the established topic-specific policy on access control.", "raw": "Information access restriction\nAccess to information and other associated assets should be restricted in accordance with the established topic-specific policy on access control."}, {"type": "control", "id": "A.8.4", "title": "Access to source code", "description": "Read and write access to source code, development tools and software libraries should be appropriately managed.", "raw": "Access to source code\nRead and write access to source code, development tools and software libraries should be appropriately managed."}, {"type": "control", "id": "A.8.5", "title": "Secure authentication", "description": "Secure authentication technologies and procedures should be implemented based on information access restrictions and the topic-specific policy on access control.", "raw": "Secure authentication\nSecure authentication technologies and procedures should be implemented based on information access restrictions and the topic-specific policy on access control."}, {"type": "control", "id": "A.8.6", "title": "Capacity management", "description": "The use of resources should be monitored and adjusted in line with current and expected capacity requirements.", "raw": "Capacity management\nThe use of resources should be monitored and adjusted in line with current and expected capacity requirements."}, {"type": "control", "id": "A.8.7", "title": "Protection against malware", "description": "Protection against malware should be implemented and supported by appropriate user awareness.", "raw": "Protection against malware\nProtection against malware should be implemented and supported by appropriate user awareness."}, {"type": "control", "id": "A.8.8", "title": "Management of technical vulnerabilities", "description": "Information about technical vulnerabilities of information systems in use should be obtained, the organization’s exposure to such vulnerabilities should be evaluated and appropriate measures should be taken.", "raw": "Management of technical vulnerabilities\nInformation about technical vulnerabilities of information systems in use should be obtained, the organization’s exposure to such vulnerabilities should be evaluated and appropriate measures should be taken."}, {"type": "control", "id": "A.8.9", "title": "Configuration management", "description": "Configurations, including security configurations, of hardware, software, services and networks should be established, documented, implemented, monitored and reviewed.", "raw": "Configuration management\nConfigurations, including security configurations, of hardware, software, services and networks should be established, documented, implemented, monitored and reviewed."}, {"type": "control", "id": "A.8.10", "title": "Information deletion", "description": "Information stored in information systems, devices or in any other storage media should be deleted when no longer required.", "raw": "Information deletion\nInformation stored in information systems, devices or in any other storage media should be deleted when no longer required."}, {"type": "control", "id": "A.8.11", "title": "Data masking", "description": "Data masking should be used in accordance with the organization’s topic-specific policy on access control and other related topic-specific policies, and business requirements, taking applicable legislation into consideration.", "raw": "Data masking\nData masking should be used in accordance with the organization’s topic-specific policy on access control and other related topic-specific policies, and business requirements, taking applicable legislation into consideration."}, {"type": "control", "id": "A.8.12", "title": "Data leakage prevention", "description": "Data leakage prevention measures should be applied to systems, networks and any other devices that process, store or transmit sensitive information.", "raw": "Data leakage prevention\nData leakage prevention measures should be applied to systems, networks and any other devices that process, store or transmit sensitive information."}, {"type": "control", "id": "A.8.13", "title": "Information backup", "description": "Backup copies of information, software and systems should be maintained and regularly tested in accordance with the agreed topic-specific policy on backup.", "raw": "Information backup\nBackup copies of information, software and systems should be maintained and regularly tested in accordance with the agreed topic-specific policy on backup."}, {"type": "control", "id": "A.8.14", "title": "Redundancy of information processing facilities", "description": "Information processing facilities should be implemented with redundancy sufficient to meet availability requirements.", "raw": "Redundancy of information processing facilities\nInformation processing facilities should be implemented with redundancy sufficient to meet availability requirements."}, {"type": "control", "id": "A.8.15", "title": "Logging", "description": "Logs that record activities, exceptions, faults and other relevant events should be produced, stored, protected and analysed.", "raw": "Logging\nLogs that record activities, exceptions, faults and other relevant events should be produced, stored, protected and analysed."}, {"type": "control", "id": "A.8.16", "title": "Monitoring activities", "description": "Networks, systems and applications should be monitored for anomalous behaviour and appropriate actions taken to evaluate potential information security incidents.", "raw": "Monitoring activities\nNetworks, systems and applications should be monitored for anomalous behaviour and appropriate actions taken to evaluate potential information security incidents."}, {"type": "control", "id": "A.8.17", "title": "Clock synchronization", "description": "The clocks of information processing systems used by the organization should be synchronized to approved time sources.", "raw": "Clock synchronization\nThe clocks of information processing systems used by the organization should be synchronized to approved time sources."}, {"type": "control", "id": "A.8.18", "title": "Use of privileged utility programs", "description": "The use of utility programs that can be capable of overriding system and application controls should be restricted and tightly controlled.", "raw": "Use of privileged utility programs\nThe use of utility programs that can be capable of overriding system and application controls should be restricted and tightly controlled."}, {"type": "control", "id": "A.8.19", "title": "Installation of software on operational systems", "description": "Procedures and measures should be implemented to securely manage software installation on operational systems.", "raw": "Installation of software on operational systems\nProcedures and measures should be implemented to securely manage software installation on operational systems."}, {"type": "control", "id": "A.8.20", "title": "Networks security", "description": "Networks and network devices should be secured, managed and controlled to protect information in systems and applications.", "raw": "Networks security\nNetworks and network devices should be secured, managed and controlled to protect information in systems and applications."}, {"type": "control", "id": "A.8.21", "title": "Security of network services", "description": "Security mechanisms, service levels and service requirements of network services should be identified, implemented and monitored.", "raw": "Security of network services\nSecurity mechanisms, service levels and service requirements of network services should be identified, implemented and monitored."}, {"type": "control", "id": "A.8.22", "title": "Segregation of networks", "description": "Groups of information services, users and information systems should be segregated in the organization’s networks.", "raw": "Segregation of networks\nGroups of information services, users and information systems should be segregated in the organization’s networks."}, {"type": "control", "id": "A.8.23", "title": "Web filtering", "description": "Access to external websites should be managed to reduce exposure to malicious content.", "raw": "Web filtering\nAccess to external websites should be managed to reduce exposure to malicious content."}, {"type": "control", "id": "A.8.24", "title": "Use of cryptography", "description": "Rules for the effective use of cryptography, including cryptographic key management, should be defined and implemented.", "raw": "Use of cryptography\nRules for the effective use of cryptography, including cryptographic key management, should be defined and implemented."}, {"type": "control", "id": "A.8.25", "title": "Secure development life cycle", "description": "Rules for the secure development of software and systems should be established and applied.", "raw": "Secure development life cycle\nRules for the secure development of software and systems should be established and applied."}, {"type": "control", "id": "A.8.26", "title": "Application security requirements", "description": "Information security requirements should be identified, specified and approved when developing or acquiring applications.", "raw": "Application security requirements\nInformation security requirements should be identified, specified and approved when developing or acquiring applications."}, {"type": "control", "id": "A.8.27", "title": "Secure system architecture and engineering principles", "description": "Principles for engineering secure systems should be established, documented, maintained and applied to any information system development activities.", "raw": "Secure system architecture and engineering principles\nPrinciples for engineering secure systems should be established, documented, maintained and applied to any information system development activities."}, {"type": "control", "id": "A.8.28", "title": "Secure coding", "description": "Secure coding principles should be applied to software development.", "raw": "Secure coding\nSecure coding principles should be applied to software development."}, {"type": "control", "id": "A.8.29", "title": "Security testing in development and acceptance", "description": "Security testing processes should be defined and implemented in the development life cycle.", "raw": "Security testing in development and acceptance\nSecurity testing processes should be defined and implemented in the development life cycle."}, {"type": "control", "id": "A.8.30", "title": "Outsourced development", "description": "The organization should direct, monitor and review the activities related to outsourced system development.", "raw": "Outsourced development\nThe organization should direct, monitor and review the activities related to outsourced system development."}, {"type": "control", "id": "A.8.31", "title": "Separation of development, test and production environments", "description": "Development, testing and production environments should be separated and secured.", "raw": "Separation of development, test and production environments\nDevelopment, testing and production environments should be separated and secured."}, {"type": "control", "id": "A.8.32", "title": "Change management", "description": "Changes to information processing facilities and information systems should be subject to change management procedures.", "raw": "Change management\nChanges to information processing facilities and information systems should be subject to change management procedures."}, {"type": "control", "id": "A.8.33", "title": "Test information", "description": "Test information should be appropriately selected, protected and managed.", "raw": "Test information\nTest information should be appropriately selected, protected and managed."}, {"type": "control", "id": "A.8.34", "title": "Protection of information systems during audit testing", "description": "Audit tests and other assurance activities involving assessment of operational systems should be planned and agreed between the tester and appropriate management.", "raw": "Protection of information systems during audit testing\nAudit tests and other assurance activities involving assessment of operational systems should be planned and agreed between the tester and appropriate management."}];

  const STORAGE_KEY = "soa_v1_iso27001_2022";
  const THEME_KEY = "soa_theme";
  const DEFAULT_ROW = {
    applicable: "",          // "Y" | "N" | ""
    exclusionJustification: "",
    implemented: "",         // "Y" | "N" | ""
    implementationDetails: "",
    reasons: { LR:false, CO:false, BR:false, BP:false, RRA:false },
    inclusionReason: "",
    collapsed: false
  };

  function loadState() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return {};
      const parsed = JSON.parse(raw);
      if (typeof parsed !== "object" || parsed === null) return {};
      return parsed;
    } catch {
      return {};
    }
  }

  function saveState(state) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  let state = loadState();

  function setTheme(theme) {
    const isDark = theme === "dark";
    document.body.classList.toggle("theme-dark", isDark);
    const btn = document.getElementById("btnTheme");
    if (btn) {
      btn.setAttribute("aria-pressed", isDark ? "true" : "false");
      btn.setAttribute("aria-label", isDark ? "Switch to light theme" : "Switch to dark theme");
      btn.setAttribute("title", isDark ? "Switch to light theme" : "Switch to dark theme");
    }
    localStorage.setItem(THEME_KEY, isDark ? "dark" : "light");
  }

  function initTheme() {
    const saved = localStorage.getItem(THEME_KEY);
    if (saved === "dark" || saved === "light") {
      setTheme(saved);
      return;
    }
    const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
    setTheme(prefersDark ? "dark" : "light");
  }

  function rowState(id) {
    if (!state[id]) state[id] = structuredClone(DEFAULT_ROW);
    // basic migration safety
    state[id].reasons = state[id].reasons || { LR:false, CO:false, BR:false, BP:false, RRA:false };
    if (typeof state[id].collapsed !== "boolean") state[id].collapsed = false;
    return state[id];
  }

  function escapeCsv(val) {
    const s = (val ?? "").toString();
    if (/[",\n\r]/.test(s)) return '"' + s.replace(/"/g, '""') + '"';
    return s;
  }

  function computeStats() {
    const controls = ITEMS.filter(x => x.type === "control");
    let applicableY = 0, applicableN = 0, applicableBlank = 0;
    let implementedY = 0, implementedN = 0, implementedBlank = 0;

    for (const c of controls) {
      const r = rowState(c.id);
      if (r.applicable === "Y") applicableY++;
      else if (r.applicable === "N") applicableN++;
      else applicableBlank++;

      if (r.implemented === "Y") implementedY++;
      else if (r.implemented === "N") implementedN++;
      else implementedBlank++;
    }

    return {
      total: controls.length,
      applicableY, applicableN, applicableBlank,
      implementedY, implementedN, implementedBlank
    };
  }

  function statusBadge(r) {
    // Simple signal (not "audit truth"): based on applicability + implementation
    if (r.applicable === "N") return { cls: "badge bad", text: "Not applicable" };
    if (r.applicable === "Y" && r.implemented === "Y") return { cls: "badge good", text: "Applicable • Implemented" };
    if (r.applicable === "Y" && r.implemented === "N") return { cls: "badge warn", text: "Applicable • Not implemented" };
    if (r.applicable === "Y" && r.implemented === "") return { cls: "badge warn", text: "Applicable • Unknown impl." };
    return { cls: "badge", text: "Not assessed" };
  }

  function render() {
    const q = document.getElementById("q").value.trim().toLowerCase();
    const list = document.getElementById("list");
    list.innerHTML = "";

    const stats = computeStats();
    const statsEl = document.getElementById("stats");
    if (statsEl) {
      statsEl.textContent = `Applicable Y: ${stats.applicableY} • Applicable N: ${stats.applicableN} • Implemented Y: ${stats.implementedY}`;
    }
    const statTotal = document.getElementById("statTotal");
    const statApplicable = document.getElementById("statApplicable");
    const statImplemented = document.getElementById("statImplemented");
    if (statTotal) statTotal.textContent = stats.total;
    if (statApplicable) statApplicable.textContent = stats.applicableY;
    if (statImplemented) statImplemented.textContent = stats.implementedY;
    const statTotalDock = document.getElementById("statTotalDock");
    const statApplicableDock = document.getElementById("statApplicableDock");
    const statImplementedDock = document.getElementById("statImplementedDock");
    if (statTotalDock) statTotalDock.textContent = stats.total;
    if (statApplicableDock) statApplicableDock.textContent = stats.applicableY;
    if (statImplementedDock) statImplementedDock.textContent = stats.implementedY;

    let currentDomain = null;
    for (const item of ITEMS) {
      if (item.type === "domain") {
        currentDomain = item;
        // Domain always shows if no search OR if any child matches later (handled by simply showing anyway when searching by control id/text)
        // If searching, we only show domains that have matching controls underneath.
        continue;
      }

      // control
      const rawText = `${item.id} ${item.title} ${item.description}`.toLowerCase();
      const matches = !q || rawText.includes(q);

      if (!matches) continue;

      // Insert domain header the first time we hit a matching control under it
      const domain = findDomainFor(item.id);
      if (domain && (!list.querySelector(`[data-domain="${domain.id}"]`))) {
        const d = document.createElement("div");
        d.className = "domain";
        d.setAttribute("data-domain", domain.id);
        d.innerHTML = `
          <div class="title">
            <strong>${domain.id}</strong>
            <span>${domain.label}</span>
          </div>
        `;
        list.appendChild(d);
      }

      const r = rowState(item.id);
      const badge = statusBadge(r);

      const row = document.createElement("div");
      row.className = "row";
      row.innerHTML = `
        <div class="rowHead">
          <div class="id">${item.id}</div>
          <div class="titleBlock">
            <h3>${escapeHtml(item.title || "(No title)")}</h3>
            <p>${escapeHtml(item.description || "")}</p>
          </div>
          <div class="status">
            <span class="${badge.cls}">${badge.text}</span>
            <button type="button" class="toggle-btn" data-action="toggle" aria-expanded="${r.collapsed ? "false" : "true"}">
              <span class="toggle-text">${r.collapsed ? "Details" : "Hide details"}</span>
              <span class="toggle-icon" aria-hidden="true"></span>
            </button>
          </div>
        </div>

        <div class="rowBody">
          <div class="rowBodyInner">
            <div class="fields">
            <div class="field col-3">
              <label>Applicable? (Y/N)</label>
              <select data-k="applicable">
                <option value="" ${
                  r.applicable === "" ? "selected" : ""
                }>—</option>
                <option value="Y" ${
                  r.applicable === "Y" ? "selected" : ""
                }>Y</option>
                <option value="N" ${
                  r.applicable === "N" ? "selected" : ""
                }>N</option>
              </select>
              <div class="hint" style="margin-top:8px;">
                If <b>N</b>, add justification. If <b>Y</b>, add inclusion reasons.
              </div>
            </div>

            <div class="field col-3">
              <label>Implemented? (Y/N)</label>
              <select data-k="implemented">
                <option value="" ${
                  r.implemented === "" ? "selected" : ""
                }>—</option>
                <option value="Y" ${
                  r.implemented === "Y" ? "selected" : ""
                }>Y</option>
                <option value="N" ${
                  r.implemented === "N" ? "selected" : ""
                }>N</option>
              </select>
              <div class="hint" style="margin-top:8px;">
                Separate from applicability (e.g., applicable but planned).
              </div>
            </div>

            <div class="field col-6">
              <label>Implementation details</label>
              <textarea data-k="implementationDetails" placeholder="Short, evidence-friendly description (e.g., tooling, process, owners, cadence)…">${
                escapeHtml(r.implementationDetails)
              }</textarea>
            </div>

            <div class="field col-6" data-show="exclusion">
              <label>Justification for exclusion (only if Applicable = N)</label>
              <textarea data-k="exclusionJustification" placeholder="Why is it not applicable to your scope / context?">${
                escapeHtml(r.exclusionJustification)
              }</textarea>
            </div>

            <div class="field col-12" data-show="inclusion">
              <label>Reasons for inclusion</label>
              <div class="reasons-grid">
                ${
                  checkbox("LR","Legal requirement", r.reasons.LR)
                }
                ${
                  checkbox("CO","Contractual obligation", r.reasons.CO)
                }
                ${
                  checkbox("BR","Business requirement", r.reasons.BR)
                }
                ${
                  checkbox("BP","Best practice", r.reasons.BP)
                }
                ${
                  checkbox("RRA","Risk assessment result", r.reasons.RRA)
                }
              </div>
              <div class="hint" style="margin-top:8px;">
                Choose all that apply. Keep it lightweight — this is “why included”, not a full risk register.
              </div>
            </div>

            <div class="field col-12" data-show="inclusion">
              <label>Reason for inclusion (1–3 sentences)</label>
              <textarea data-k="inclusionReason" placeholder="E.g., selected due to contractual requirements and risk assessment outcomes; supports incident detection and evidencing.">${
                escapeHtml(r.inclusionReason)
              }</textarea>
            </div>
            </div>
          </div>
        </div>
      `;

      row.classList.toggle("is-collapsed", r.collapsed);

      // wire events
      row.querySelectorAll("select, textarea, input[type='checkbox']").forEach(el => {
        el.addEventListener("change", () => onChange(item.id, el));
        el.addEventListener("input", () => onInput(item.id, el));
      });
      const head = row.querySelector(".rowHead");
      if (head) {
        head.addEventListener("click", (e) => {
          if (e.target.closest("button")) return;
          toggleRow(item.id);
        });
      }
      const toggleBtn = row.querySelector("[data-action='toggle']");
      if (toggleBtn) {
        toggleBtn.addEventListener("click", () => toggleRow(item.id));
      }

      list.appendChild(row);

      // show/hide conditional sections
      applyConditionalVisibility(row, r);
    }

    saveState(state);
  }

  function applyConditionalVisibility(rowEl, r) {
    const showEx = r.applicable === "N";
    const showIn = r.applicable === "Y";
    rowEl.querySelectorAll("[data-show='exclusion']").forEach(el => el.style.display = showEx ? "block" : "none");
    rowEl.querySelectorAll("[data-show='inclusion']").forEach(el => el.style.display = showIn ? "block" : "none");
  }

  function toggleRow(id) {
    const r = rowState(id);
    r.collapsed = !r.collapsed;
    saveState(state);
    render();
  }

  function onChange(id, el) {
    const r = rowState(id);

    if (el.dataset.k === "applicable") {
      r.applicable = el.value;
      // light hygiene
      if (r.applicable !== "N") r.exclusionJustification = "";
      if (r.applicable !== "Y") {
        r.reasons = { LR:false, CO:false, BR:false, BP:false, RRA:false };
        r.inclusionReason = "";
      }
      saveState(state);
      render();
      return;
    }

    if (el.dataset.k === "implemented") {
      r.implemented = el.value;
      saveState(state);
      render();
      return;
    }

    if (el.dataset.reason) {
      const k = el.dataset.reason;
      r.reasons[k] = !!el.checked;
      saveState(state);
      render();
      return;
    }
  }

  function onInput(id, el) {
    const r = rowState(id);
    const k = el.dataset.k;
    if (!k) return;
    r[k] = el.value;
    saveState(state);
  }

  function checkbox(code, label, checked) {
    const c = checked ? "checked" : "";
    return `
      <label class="reason-pill">
        <input type="checkbox" data-reason="${code}" ${c} />
        <span class="reason-text"><strong>${code}</strong><em>${label}</em></span>
      </label>
    `;
  }

  function escapeHtml(s) {
    return (s ?? "").toString()
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;");
  }

  function findDomainFor(controlId) {
    // controlId: A.5.1 → domain A.5
    const m = controlId.match(/^(A\.\d)\./);
    if (!m) return null;
    const domainId = m[1];
    return ITEMS.find(x => x.type === "domain" && x.id === domainId) || null;
  }

  function exportCsv() {
    // template-aligned columns:
    // CONTROL, CONTROL TITLE & DESCRIPTION, APPLICABLE? (Y/N), JUSTIFICATION FOR EXCLUSION,
    // IMPLEMENTED? (Y/N), IMPLEMENTATION DETAILS, LR, CO, BR / BP, RRA, REASON FOR INCLUSION
    const lines = [];
    lines.push([
      "CONTROL",
      "CONTROL TITLE & DESCRIPTION",
      "APPLICABLE? (Y/N)",
      "JUSTIFICATION FOR EXCLUSION",
      "IMPLEMENTED? (Y/N)",
      "IMPLEMENTATION DETAILS",
      "LR",
      "CO",
      "BR / BP",
      "RRA",
      "REASON FOR INCLUSION"
    ].map(escapeCsv).join(","));

    for (const item of ITEMS) {
      if (item.type !== "control") continue;
      const r = rowState(item.id);
      const brbp = [r.reasons.BR ? "BR" : "", r.reasons.BP ? "BP" : ""].filter(Boolean).join(";");
      lines.push([
        item.id,
        item.raw || `${item.title}\n${item.description}`,
        r.applicable,
        r.exclusionJustification,
        r.implemented,
        r.implementationDetails,
        r.reasons.LR ? "Y" : "",
        r.reasons.CO ? "Y" : "",
        brbp ? "Y (" + brbp + ")" : "",
        r.reasons.RRA ? "Y" : "",
        r.inclusionReason
      ].map(escapeCsv).join(","));
    }

    const blob = new Blob([lines.join("\n")], { type: "text/csv;charset=utf-8" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "soa_iso27001_2022.csv";
    a.click();
    URL.revokeObjectURL(a.href);
  }

  function exportRows() {
    const rows = {};
    for (const item of ITEMS) {
      if (item.type !== "control") continue;
      const r = rowState(item.id);
      rows[item.id] = {
        applicable: r.applicable || "",
        exclusionJustification: r.exclusionJustification || "",
        implemented: r.implemented || "",
        implementationDetails: r.implementationDetails || "",
        reasons: {
          LR: !!r.reasons?.LR,
          CO: !!r.reasons?.CO,
          BR: !!r.reasons?.BR,
          BP: !!r.reasons?.BP,
          RRA: !!r.reasons?.RRA
        },
        inclusionReason: r.inclusionReason || ""
      };
    }
    return rows;
  }

  function exportJson() {
    const out = {
      meta: {
        standard: "ISO/IEC 27001:2022",
        type: "Statement of Applicability (SoA)",
        exportedAt: new Date().toISOString(),
        version: 1
      },
      rows: exportRows()
    };

    const blob = new Blob([JSON.stringify(out, null, 2)], { type: "application/json;charset=utf-8" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "soa_iso27001_2022.json";
    a.click();
    URL.revokeObjectURL(a.href);
  }

  function importJsonFile(file) {
    const reader = new FileReader();
    reader.onload = () => {
      try {
        const parsed = JSON.parse(reader.result);
        const rows = parsed?.rows;
        if (!rows || typeof rows !== "object") throw new Error("Invalid file: missing rows");
        state = rows;
        saveState(state);
        render();
        alert("Imported OK.");
      } catch (e) {
        alert("Import failed: " + (e?.message || e));
      }
    };
    reader.readAsText(file);
  }

  function resetAll() {
    if (!confirm("Reset all SoA inputs? This clears local browser data for this tool.")) return;
    state = {};
    localStorage.removeItem(STORAGE_KEY);
    render();
  }

  function updateDockVisibility() {
    const dock = document.getElementById("statsDock");
    const hero = document.querySelector(".soa-hero");
    if (!dock || !hero) return;
    const show = hero.getBoundingClientRect().bottom < 0;
    dock.classList.toggle("is-visible", show);
    dock.setAttribute("aria-hidden", show ? "false" : "true");
  }

  function updateBackToTop() {
    const btn = document.getElementById("btnTop");
    if (!btn) return;
    btn.classList.toggle("is-visible", window.scrollY > 360);
  }

  // Wiring
  document.getElementById("q").addEventListener("input", () => render());
  document.getElementById("btnCsv").addEventListener("click", exportCsv);
  document.getElementById("btnJson").addEventListener("click", exportJson);
  document.getElementById("btnReset").addEventListener("click", resetAll);
  const themeBtn = document.getElementById("btnTheme");
  if (themeBtn) {
    themeBtn.addEventListener("click", () => {
      const isDark = document.body.classList.contains("theme-dark");
      setTheme(isDark ? "light" : "dark");
    });
  }
  document.getElementById("importJson").addEventListener("change", (e) => {
    const f = e.target.files?.[0];
    if (f) importJsonFile(f);
    e.target.value = "";
  });

  const topBtn = document.getElementById("btnTop");
  if (topBtn) {
    topBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
    });
  }

  window.addEventListener("scroll", () => {
    updateDockVisibility();
    updateBackToTop();
  });
  window.addEventListener("resize", updateDockVisibility);

  initTheme();
  render();
  updateDockVisibility();
  updateBackToTop();
